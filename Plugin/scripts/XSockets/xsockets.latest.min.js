var xsockets;(function(n){var t=function(){function t(n,t){this._isOpen=!1;this._subscriptions={};this.promises={};this.onOpen=function(){};this.onClose=function(){};this.onMessage=function(){};this._transport=n;this.name=t}return t.prototype.dispatchEvent=function(t){switch(t.T){case n.events.open:this._isOpen=!0;var i=JSON.parse(t.D);this._controllerId=i.CI;this._transport.setPersistentId(i.PI);this.onOpen(i);break;case n.events.close:this._isOpen=!1;this.onClose();break;default:if(!this.firePromise(t)&&!this.fireSubscription(t))this.onMessage(t)}},t.prototype.firePromise=function(t){var i=this.promises[t.T];return i!==undefined?(t.messageType===n.messageType.text?i(JSON.parse(t.D)):i(t.D),delete this.promises[t.T],!0):!1},t.prototype.fireSubscription=function(t){var i=this._subscriptions[t.T];return i!==undefined?(t.messageType===n.messageType.text?i(JSON.parse(t.D)):i({binary:t.B,metadata:t.D}),!0):!1},t.prototype.open=function(){this._transport.isConnected()&&!this._isOpen&&this._transport.socket.send(new n.message(this.name,n.events.init))},t.prototype.close=function(t){t===void 0&&(t=!1);this._transport.isConnected()&&this._isOpen&&this._transport.socket.send(new n.message(this.name,n.events.close));this.onClose();t&&this._transport.disposeController(this)},t.prototype.on=function(n,t){n=n.toLowerCase();typeof t=="function"&&(this._subscriptions[n]=t);typeof t=="undefined"&&delete this._subscriptions[n]},t.prototype.off=function(n){n=n.toLowerCase();delete this._subscriptions[n]},t.prototype.invoke=function(t,i){if(t=t.toLowerCase(),this._transport.isConnected()){i===undefined&&(i="");var r=new n.message(this.name,t,i);this._transport.socket.send(r)}return new n.promise(this,t)},t.prototype.invokeBinary=function(t,i,r){r===void 0&&(r=undefined);t=t.toLowerCase();var u=new n.message(this.name,t,r,i);return this._transport.socket.send(u.createBuffer()),this},t.prototype.publishBinary=function(n,t,i){return i===void 0&&(i=undefined),this.invokeBinary(n,t,i)},t.prototype.subscribe=function(t,i){t=t.toLowerCase();this.on(t,i);if(this._transport.isConnected()&&typeof i=="function"){var r=new n.message(this.name,n.events.subscribe,{T:t,A:!1});this._transport.socket.send(r)}},t.prototype.unsubscribe=function(t){if(t=t.toLowerCase(),delete this._subscriptions[t],this._transport.isConnected()){var i=new n.message(this.name,n.events.unsubscribe,{T:t,A:!1});this._transport.socket.send(i)}},t.prototype.publish=function(n,t){return n=n.toLowerCase(),this.invoke(n,t)},t.prototype.setProperty=function(n,t){return this.invoke("set_"+n,t)},t.prototype.getProperty=function(n,t){var i=this;this.on("get_"+n,function(r){i.off("get_"+n);t(r)});return this.invoke("get_"+n,undefined)},t}();n.controller=t})(xsockets||(xsockets={})),function(n){(function(n){n[n.text=0]="text";n[n.binary=1]="binary"})(n.messageType||(n.messageType={}));var t=n.messageType}(xsockets||(xsockets={})),function(n){var t=function(){function t(t,i,r,u){r===void 0&&(r=undefined);u===void 0&&(u=undefined);this.C=t;this.T=i;this.B=u;this.D=n.utils.isJson(r)?r:JSON.stringify(r);this.messageType=this.B==undefined?n.messageType.text:n.messageType.binary}return t.prototype.createBuffer=function(){var n=this.toString(),t=new Uint8Array(this.longToByteArray(n.length));return this.appendBuffer(this.appendBuffer(t,this.stringToBuffer(n)),this.B)},t.prototype.extractMessage=function(){var u=function(n){return String.fromCharCode.apply(null,new Uint16Array(n))},t=function(n){for(var t=0,i=n.byteLength-1;i>=0;i--)t=t*256+n[i];return t},i=new Uint8Array(this.B,0,8),f=t(i),r=8+t(i),e=new Uint8Array(this.B,r,this.B.byteLength-r),o=new Uint8Array(this.B,8,f),n=this.parse(u(o),e);return n.D=typeof n.D=="object"?n.D:JSON.parse(n.D),n},t.prototype.parse=function(n,i){var r=JSON.parse(n);return new t(r.C,r.T,r.D||JSON.stringify({}),i)},t.prototype.toString=function(){return JSON.stringify({C:this.C,D:this.D,T:this.T,Q:this.Q,R:this.R,I:this.I})},t.prototype.appendBuffer=function(n,t){var i=new Uint8Array(n.byteLength+t.byteLength);return i.set(new Uint8Array(n),0),i.set(new Uint8Array(t),n.byteLength),i.buffer},t.prototype.stringToBuffer=function(n){for(var i=n.length,r=new Array(i),t=0;t<i;t++)r[t]=n.charCodeAt(t)&255;return new Uint8Array(r).buffer},t.prototype.longToByteArray=function(n){for(var r,t=[0,0,0,0,0,0,0,0],i=0;i<t.length;i++)r=n&255,t[i]=r,n=(n-r)/256;return t},t}();n.message=t}(xsockets||(xsockets={})),function(n){var t,i,r;n.version="6.1.0";t=function(){function n(){}return n.authfailed="0",n.init="1",n.open="2",n.close="3",n.error="4",n.subscribe="5",n.unsubscribe="6",n.ping="7",n.pong="8",n}();n.events=t;i=function(){function n(){}return n.set="s1",n.get="s2",n.clear="s3",n.remove="s4",n}();n.storage=i;r=function(){function n(){}return n.guid=function(){for(var n,t=n="";n++<36;t+=n*51&52?(n^15?8^Math.random()*(n^20?16:4):4).toString(16):"-");return t},n.isJson=function(n){try{JSON.parse(n)}catch(t){return!1}return!0},n}();n.utils=r}(xsockets||(xsockets={})),function(n){var t=function(){function n(n,t){this._controller=n;this._name=t}return n.prototype.then=function(n){this._controller.promises[this._name]=n},n}();n.promise=t}(xsockets||(xsockets={})),function(n){var t=function(){function t(t,i){i===void 0&&(i=[]);this._autoReconnect=!1;this._autoReconnectTimeout=5e3;this._readyState=WebSocket.CLOSED;this.onOpen=function(){};this.onAuthenticationFailed=function(){};this.onClose=function(){};this.onMessage=function(){};this.onError=function(){};this._parameters={};this._persistentId=localStorage.getItem(t);this._server=t;this.subprotocol="XSocketsNET";this._controllers=[];for(var r in i)this._controllers.push(new n.controller(this,i[r].toLowerCase()))}return t.prototype.autoReconnect=function(n,t){n===void 0&&(n=!0);t===void 0&&(t=5e3);this._autoReconnect=n;this._autoReconnectTimeout=t},t.prototype.setParameters=function(n){this._parameters=n},t.prototype.setPersistentId=function(n){this._persistentId=n;localStorage.setItem(this._server,this._persistentId)},t.prototype.open=function(){var t=this,i=this;(this._persistentId&&(this._parameters.persistentid=this._persistentId),this.socket===undefined||this.socket.readyState!==WebSocket.OPEN)&&(this.socket=new WebSocket(this._server+this.querystring(),[this.subprotocol]),this.socket.binaryType="arraybuffer",this.socket.onopen=function(i){t._readyState=WebSocket.OPEN;t.onOpen(i);for(var r in t._controllers)t.sendtext(new n.message(t._controllers[r].name,n.events.init))},this.socket.onclose=function(n){if(t.socket=undefined,t._readyState===WebSocket.OPEN){t.onClose(n);for(var r in t._controllers)t._controllers[r].close()}t._readyState=WebSocket.CLOSED;t._autoReconnect&&setTimeout(function(){i.open()},t._autoReconnectTimeout)},this.socket.onmessage=function(i){var u,r,f;if(typeof i.data=="string"){if(u=JSON.parse(i.data),r=new n.message(u.C,u.T,u.D,undefined),r.T===n.events.open&&t.setPersistentId(JSON.parse(r.D).PI),r.T===n.events.error){t.onError(u);return}if(r.T===n.events.authfailed){t.onAuthenticationFailed(r.D);t.close(!1);return}if(f=t.controller(r.C,!1),f==undefined)t.onMessage(u);else f.dispatchEvent(r)}else if(typeof i.data=="object"){var o=new n.message("","","",i.data),e=o.extractMessage(),f=t.controller(e.C,!1);if(f==undefined)t.onMessage(i.data);else f.dispatchEvent(e)}},this.socket.onerror=function(n){t.onError(n)})},t.prototype.close=function(n){n===void 0&&(n=!1);this._autoReconnect=n;this.socket!=undefined&&this.socket.close()},t.prototype.controller=function(t,i){var r,u;i===void 0&&(i=!0);r=undefined;for(u in this._controllers)if(this._controllers[u].name===t.toLowerCase()){r=this._controllers[u];break}return r===undefined&&i&&(r=new n.controller(this,t.toLocaleLowerCase()),this._controllers.push(r),this.sendtext(new n.message(r.name,n.events.init))),r},t.prototype.disposeController=function(n){var t=this._controllers.indexOf(n,0);t>-1&&this._controllers.splice(t,1)},t.prototype.sendtext=function(n){this.socket!=undefined&&this.socket.send(n)},t.prototype.isConnected=function(){return this.socket!==undefined&&this.socket.readyState===WebSocket.OPEN},t.prototype.querystring=function(){var n="?";for(var t in this._parameters)n+=t+"="+encodeURIComponent(this._parameters[t])+"&";return n.slice(0,n.length-1)},t}();n.client=t}(xsockets||(xsockets={}));